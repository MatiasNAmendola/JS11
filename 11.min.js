if(typeof window==="undefined"&&typeof global==="undefined")var console={log:function(h){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?h="message"in arguments[0]?arguments[0].message:"":typeof h==="undefined"&&(h="");postMessage({type:"console",message:h})}};var JS11={};JS11.Compiler=new Function;if(typeof exports!=="undefined")exports.Compiler=JS11.Compiler;
(function(h){h.toJS=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");this.blockscan=a.indexOf('"use caution"')>-1?!0:!1;this.prism=a.indexOf('"use prism"')>-1?!0:!1;this.text=a;this.resetPlaceholderArrays();this.strikeImmutableElements();this.blockifyIndents();this.convertEnglishOperators();this.normaliseFormatting();this.detectNonEmptyObjectLiterals();this.preserveEmptyObjectLiterals();
this.wrapLoopsAndConditionals();this.insertVar();this.shorthandLoops();this.convertMessagingSyntax();this.reconstituteFunctions();this.reconstituteObjectLiterals();this.convertNamedArguments();this.rewriteWith();this.separateAdjacentTerminators();this.restoreImmutables();this.finalise();this.resetPlaceholderArrays();a=this.text;this.text="";return a};h.text="";h.placeholders={};h.resetPlaceholderArrays=function(){this.placeholders.blockcomments=[];this.placeholders.linecomments=[];this.placeholders.strings=
[];this.placeholders.regex=[]};h.enumerateRegex=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c="",e="";a.charAt(0)!=="/"&&(c=a.substr(0,a.indexOf("/")),a=a.substring(a.indexOf("/"),a.length));a.charAt(a.length-1).match(/[\/gimy]/)===null&&(e=a.charAt(a.length-1),a=a.substring(0,a.length-1));this.placeholders.regex.push(a);return c+"@PLACEHOLDERREGEX"+(this.placeholders.regex.length-
1)+"END"+e};h.enumerateString=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");if(a.match(/\n/)!==null){var c=a.split("\n"),e=Infinity,b,f=!0;if(c[0].match(/^ +/)===null)for(var d=1;d<c.length;d++){var l=c[d].replace(/^( +|\t+)[^\1][\s\S]*$/,"$1");if(l!==c[d]){if(l.charAt(0)!==b&&d>1){f=!1;break}e=Math.min(l.length,e);b=l.charAt(0)}else e=0}if(e>0&&e<Infinity&&f===!0){for(d=1;d<c.length;d++)c[d]=
c[d].substring(e,c[d].length);a=c.join("\n")}}this.placeholders.strings.push(a);return"@PLACEHOLDERSTRINGS"+(this.placeholders.strings.length-1)+"END"};h.enumerateBlockComment=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c="";a.charAt(0)!=="/"&&(c=a.charAt(0),a=a.substring(1,a.length));this.placeholders.blockcomments.push(a);return c+"@PLACEHOLDERBLOCKCOMMENTS"+(this.placeholders.blockcomments.length-
1)+"END"};h.enumerateLineComment=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c="",e="";a.charAt(0)!=="/"&&(c=a.charAt(0),a=a.substring(1,a.length));a.charAt(a.length-1)==="\n"&&(e="\n",a=a.substring(0,a.length-1));this.placeholders.linecomments.push(a);return c+"@PLACEHOLDERLINECOMMENTS"+(this.placeholders.linecomments.length-1)+"END"+e};h.getPlaceholder=function(a){arguments.length===
1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c=a.replace(/@PLACEHOLDER([^\d]+)\d+END/,"$1").toLowerCase(),e=Number(a.replace(/@PLACEHOLDER[^\d]+(\d+)END/,"$1"));return this.placeholders[c][e]};h.preserveKeywordSpacing=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");return a.charAt(1).match(/^\w/)===
null?a.replace(/^ *([\(\)\{\}\=\:,\|\&\*\+\/\-\!\[\]\?<>\;]) */,"$1"):a.replace(/([\s\S])(\w+) *([\(\)\{\}\=\:,\|\&\*\+\/\-\!\[\]\?<>\;]) */,"$1$2 $3")};h.restoreObjectLiteral=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c=0,e=a.indexOf("("),b;for(b=e;b<a.length;b++)if(a.charAt(b).match(/\(/)!==null?c++:a.charAt(b).match(/\)/)!==null&&c--,c===0)break;return"{"+a.substring(e+1,
b)+"}"+a.substring(b+1,a.length)};h.withHandler=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a==="undefined"&&(a="");var c=0,e=0,b=a.indexOf("with"),f,d="",l=[],k="",g;for(f=b;f<a.length;f++)if(a.charAt(f).match(/[\(\{]/)!==null)c++,c===1&&a.charAt(f)==="{"&&(b=f);else if(a.charAt(f).match(/[\}\)]/)!==null&&(c--,c===0))if(a.charAt(f)===")")d=a.substring(a.substring(b,f).indexOf("(")+(b+1),f);else if(a.charAt(f)===
"}"){e=f;break}if(e===0)return a;c=a.substring(b+1,e);if(d.match(/as [a-zA-Z$_][\w$]*$/)!==null){b=0;g=-1;for(f=0;f<d.length;f++)d.charAt(f).match(/[\{\(\[]/)!==null&&b++,d.charAt(f).match(/[\}\)\]]/)!==null&&b--,b===0&&d.charAt(f)===","&&(l.push(d.substring(g+1,f)),g=f,f++),f===d.length-1&&l.push(d.substring(g+1,f+1));d="";for(f=0;f<l.length;f++)k+=l[f].replace(/[\s\S]*as ([a-zA-Z$_][\w$]*)$/,"$1")+",",d+=l[f].replace(/([\s\S]*[^\s]+)\s*as [a-zA-Z$_][\w$]*$/,"$1")+",";c="(function ("+k.substring(0,
k.length-1)+"){"+c+"}).call(this,"+d.substring(0,d.length-1)+")";a=a.substring(0,a.indexOf("with"))+c+a.substring(e+1,a.length)}return a};h.strikeImmutableElements=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="compiler"in arguments[0]?arguments[0].compiler:this:typeof a==="undefined"&&(a=this);this.text=this.text.replace(/isn't/g,"@PLACEHOLDERISNTEND");this.text=this.text.replace(/([^\\])\/\//g,"$1@PLACEHOLDERDOUBLEFORWARDSLASHEND");this.text=this.text.replace(/[^\/\w"']\/[^\/\*\n]([^\n]*?[^\\\n])?\/[gimy]{0,4}/g,
function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.enumerateRegex.call(a,c)});this.text=this.text.replace(/@PLACEHOLDER{1}DOUBLEFORWARDSLASHEND/g,"//");this.text=this.text.replace(/(["'])(\\\1|[^\1\n]|\\\n)*?\1/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.enumerateString.call(a,c)});this.text=this.text.replace(/\/\*[\s\S]*?\*\//g,
function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.enumerateBlockComment.call(a,c)});this.text=this.text.replace(/\/\/[^\n]*\n/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.enumerateLineComment.call(a,c)});this.text=this.text.replace(/@PLACEHOLDER{1}ISNTEND/g,"isn't")};h.blockifyIndents=function(){if(this.blockscan){for(var a=
this.text.split("\n"),c=0,e=0,b=0;b<a.length;b++){c=a[b].replace(/^(  |\t*).*$/,"$1").replace(/  /," ").length;if(c>e)for(var f=0;f<c-e;f++)a[b-1]+="{";else if(c<e)for(f=0;f<e-c;f++)a[b-1]+="}";e=c}this.text=a.join("\n")}};h.normaliseFormatting=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="compiler"in arguments[0]?arguments[0].compiler:this:typeof a==="undefined"&&(a=this);this.text=this.text.replace(/\r\n/g,"\n");this.text=this.text.replace(/\t/g," ");
this.text=this.text.replace(/ +/g," ");this.text=this.text.replace(/\n /g,"\n");this.text=this.text.replace(/([^\w\$])function[ \t]*([^\w\$])/g,"$1$2");this.text=this.text.replace(/^function[ \t]*((?: *\n* *)*)([^\w\$])/,"$1$2");this.text=this.text.replace(/([^\w\$])(if|for|while|catch|switch):/g,"$1$2");this.text=this.text.replace(/(([^\w\$](if|for|while|catch|return|switch|typeof|instanceof|in|throw|finally))| *) *([\(\)\{\}\=\:,\|\&\*\+\/\-\!\[\]\?<>\;]) */g,function(c){arguments.length===1&&typeof arguments[0]===
"object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.preserveKeywordSpacing.call(a,c)});this.text=this.text.replace(/[\,\;](\s*)((?:@PLACEHOLDER[A-Z]+COMMENTS+\d+END\s*)*)(\s*)(\})/g,"$1$2$3$4");this.text=this.text.replace(/\,(\s*)((?:@PLACEHOLDER[A-Z]+COMMENTS+\d+END\s*)*)(\s*)(\))/g,"$1$2$3$4");this.text=this.text.replace(/([:\?])((?: *\n* *)*)((?:@PLACEHOLDER[A-Z]+COMMENTS+\d+END\s*)*)((?: *\n* *)*)(\S)/g,"$2$3$4$1$5")};h.convertEnglishOperators=function(){this.text=
this.text.replace(/([^\w$.])isn'?t([^:)\w$])/g,"$1is not$2");this.text=this.text.replace(/([^\w$.])(?:is\s*)?not\s*like([^:)\w$])/g,"$1!=$2");this.text=this.text.replace(/([^\w$.])(?:is\s*)?like([^:)\w$])/g,"$1==$2");this.text=this.text.replace(/([^\w$.])(?:(?:is\s*not)|isn'?t)([^:)\w$])</g,"$1>=$2");this.text=this.text.replace(/([^\w$.])(?:(?:is\s*not)|isn'?t)([^:)\w$])>/g,"$1<=$2");this.text=this.text.replace(/([^\w$.])(?:(?:is\s*not)|isn'?t)([^:)\w$])/g,"$1!==$2");this.text=this.text.replace(/([^\w$.])is(\s*[<>!=])/g,
"$1$2");this.text=this.text.replace(/([^\w$.])is([^:)\w$])/g,"$1===$2");this.text=this.text.replace(/([^\w$.])not([^:)\w$])/g,"$1!$2");this.text=this.text.replace(/([^\w$.])and([^:)\w$])/g,"$1&&$2");this.text=this.text.replace(/([^\w$.])or([^:)\w$])/g,"$1||$2")};h.insertVar=function(){this.text=this.text.replace(/^(\s*)(\(?)\* *(\n*) */gm,"$1$2var $2");this.text=this.text.replace(/([\({;:])\* *(\n*) */g,"$1var $2")};h.detectNonEmptyObjectLiterals=function(){var a=0,c=!1,e=this.text.lastIndexOf("}")+
1,b=[],f,d,l=0;for(f=0;f<this.text.length;f++)this.text.charAt(f)==="{"&&b.push(f);for(f=d=b.shift();f<=e;f++)if(this.text.charAt(f).match(/[\({]/)!==null?a++:this.text.charAt(f).match(/[\)}]/)!==null&&a--,a===1&&this.text.charAt(f)===":"&&this.text.substring(d,f).match(/\?|case/i)===null&&(c=!0),f>d+250&&c===!1)a=0,f=d=b.shift()+l,f--;else if(a===0){if(c===!0&&this.text.charAt(f)==="}")this.text=this.text.substring(0,d)+"OBJECTLITERALSTART("+this.text.substring(d+1,f)+")"+this.text.substring(f+1,
this.text.length),l+=18,e+=18;c=!1;a=0;f=d=b.shift()+l;f--}};h.preserveEmptyObjectLiterals=function(){this.text=this.text.replace(/([\[\=\|\:\&\!\(,\}\(]|return\s*)\{\}/g,"$1OBJECTLITERALSTART()")};h.wrapLoopsAndConditionals=function(){var a=/[^\w\$](if|for|while|catch|switch|with)[^\w\$]/g,c=[],e,b,f,d,l;for(this.text.match(/^(if|for|while|catch|switch|with)[^\w\$]/)!==null&&c.push(this.text.replace(/^(if|for|while|catch|switch|with)[\s\S]*$/,"$1").length);a.exec(this.text)!==null;)this.text.substring(0,
a.lastIndex-1).match(/\} *while$/)===null&&c.push(a.lastIndex-1);c.reverse();for(a=0;a<c.length;a++){b=c[a];d=f=0;for(e=b;e<this.text.length;e++){l=this.text.charAt(e);l==="("&&(f===0&&d++,f++);l===")"&&f--;if(f<0)break;if(f===0&&l==="{"){expression=this.text.substring(b,e);if(expression.match(/^\s*\([\s\S]*\)\s*$/)===null||d>1)this.text=this.text.substring(0,b)+"("+expression.replace(/^\s*([\s\S]*?)\s*$/,"$1")+")"+this.text.substring(e,this.text.length);break}}}this.text=this.text.replace(/([^\w\$])(if|for|while|catch|switch|with)\s*/g,
"$1$2")};h.shorthandLoops=function(){for(var a;this.text.match(/([^\w\d$])(\d+)[ \t]*\{/)!==null;)a="_"+Math.ceil(Math.random()*1E3),this.text=this.text.replace(/([^\w\d$])(\d+)[ \t]*\{/,"$1for(var "+a+"=0;"+a+"<$2;"+a+"++){");for(;this.text.match(/([^\w\d$])for\s*\(\s*(\d+)\s*\)[ \t]*\{/)!==null;)a="_"+Math.ceil(Math.random()*1E3),this.text=this.text.replace(/([^\w\d$])for\s*\(\s*(\d+)\s*\)[ \t]*\{/,"$1for(var "+a+"=0;"+a+"<$2;"+a+"++){");this.text=this.text.replace(/([^\w\d$])(\d+)\s*as\s+([a-zA-Z_\$][\w$]*)[ \t]*\{/,
"$1for(var $3=0;$3<$2;$3++){");this.text=this.text.replace(/([^\w\d$])for\s*\(\s*(\d+)\s*as\s+([a-zA-Z_$][\w$]*)\s*\)[ \t]*\{/,"$1for(var $3=0;$3<$2;$3++){")};h.convertMessagingSyntax=function(){function a(a,b,d){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?(d="endIndex"in arguments[0]?arguments[0].endIndex:0,b="startIndex"in arguments[0]?arguments[0].startIndex:0,a="block"in arguments[0]?arguments[0].block:""):(typeof d==="undefined"&&(d=0),typeof b==="undefined"&&
(b=0),typeof a==="undefined"&&(a=""));if(a.match(/^\[\s*(?:\*|(?:var\s+))\s*[\w$\/]+\s*=?\s*new\s+\S+?\s*(?:\([\s\S]*\))?\s*\]$/)!==null)return 0;if(a.match(/^\[\s*(?:delete|promote|demote)\s+[\w$\/]+\s*\]$/)!==null)return 1;if(a.match(/^\[\s*[\w$\/]+\s+[a-zA-Z_$][\w$]*(?:\s*,\s*[a-zA-Z_$][\w$]*)*\s*\]$/)!==null)return 2;if(a.match(/^\[\s*[\w$\/]+\s+[a-zA-Z_$][\w$]*\s*\((?:[\s\S]*?)?\)\s*\]$/)!==null)return 3;if(a.match(/^\[\s*[\w$\/]+\s*\{[\s\S]*?\}\]$/)!==null)return 4;return-1}if(this.prism){var c=
[],e,b,f,d,l=!1;for(e=/\[/g;e.exec(this.text)!==null;)c.push(e.lastIndex-1);var k=[];for(e=0;e<c.length;e++){d=0;var g=!0;for(b=c[e];b<this.text.length;b++)if(this.text.charAt(b).match(/[\{\(\[]/)!==null&&d++,this.text.charAt(b).match(/[\}\)\]]/)!==null&&d--,d===0){if(this.text.charAt(b)==="]"){var h=this.text.substring(c[e],b+1);d=a.call(this,h,c[e],b);f=this.text.substring(b+1,this.text.length).match(/^\s*\{/)!==null?!0:!1;d>=0&&k.push({type:d,hasHandler:f,startIndex:c[e],endIndex:b,raw:h,simple:g})}break}else if(d>
1&&this.text.charAt(b)==="["){h=0;for(f=b;f<this.text.length;f++)if(this.text.charAt(f).match(/[\{\(\[]/)!==null&&h++,this.text.charAt(f).match(/[\}\)\]]/)!==null&&h--,h===0&&this.text.charAt(f)==="]"){var m=this.text.substring(b,f+1);if(a.call(this,m,b,f)!==-1){g=!1;break}}}}k.reverse();for(e=0;e<k.length;e++)if(h=k[e],h.simple===!0){contents=h.raw.substring(1,h.raw.length-1).replace(/^\s*([\s\S]+?)\s*$/,"$1");if(h.type===2&&!h.hasHandler)h.type=3;var o;f=[];var p,c="type:";switch(h.type){case 0:b=
contents.replace(/^(?:\*|(?:var\s+))\s*([\w$\/]+)\s*=?\s*new\s+(\S+?)\s*(?:\(([\s\S]*)\))?$/,"$1::$2::$3").split("::");o=b[0];g=b.length>1?b[1]:"";m=b.length>2?b[2]:"";d=0;lastComma=-1;for(b=0;b<m.length;b++)m.charAt(b).match(/[\{\(\[]/)!==null&&d++,m.charAt(b).match(/[\}\)\]]/)!==null&&d--,d===0&&m.charAt(b)===","&&(f.push(m.substring(lastComma+1,b)),lastComma=b,b++),b===m.length-1&&f.push(m.substring(lastComma+1,b+1));c+=this.enumerateString('"create"')+",constructor:"+this.enumerateString('"'+
g+'"');c+=f.length>0&&f[0].match(/^[a-zA-Z_$][\w$]*:/)!==null?g==="Object"?",args:[PRISMEXPRESSIONSTART(new Object("+f.join(",")+"))]":",args:[PRISMEXPRESSIONSTART("+f.join(",")+")]":",args:[PRISMEXPRESSIONSTART("+(f.length>0?f.join("),PRISMEXPRESSIONSTART("):"")+")]";break;case 1:b=contents.replace(/^(delete|promote|demote)\s+([\w$\/]*)$/,"$1::$2").split("::");mode=b[0];o=b.length>1?b[1]:"";c+=this.enumerateString('"'+mode+'"');break;case 2:b=contents.replace(/^([\w$\/]+)\s+([a-zA-Z_$][\w$]*(?:\s*,\s*[a-zA-Z_$][\w$]*)*)$/,
"$1::$2").split("::");o=b[0];p=b.length>1?b[1].replace(/\s*/g,"").split(","):[];c+=this.enumerateString('"query"');c+=",properties:["+this.enumerateString('"'+p.join('","')+'"')+"]";break;case 3:b=contents.replace(/^([\w$\/]+)\s+([a-zA-Z_$][\w$]*)\s*(?:\(([\s\S]+?)?\))?$/,"$1::$2::$3").split("::");o=b[0];if(o.indexOf(",")!==-1){h.type=2;b=contents.replace(/^([\w$\/]+)\s+([a-zA-Z_$][\w$]*(?:\s*,\s*[a-zA-Z_$][\w$]*)*)$/,"$1::$2").split("::");o=b[0];p=b.length>1?b[1].replace(/\s*/g,"").split(","):[];
c+=this.enumerateString('"query"');c+=",properties:["+this.enumerateString('"'+p.join('","')+'"')+"]";break}g=b.length>1?b[1]:"";m=b.length>2?b[2]:"";d=0;lastComma=-1;for(b=0;b<m.length;b++)m.charAt(b).match(/[\{\(\[]/)!==null&&d++,m.charAt(b).match(/[\}\)\]]/)!==null&&d--,d===0&&m.charAt(b)===","&&(f.push(m.substring(lastComma+1,b)),lastComma=b,b++),b===m.length-1&&f.push(m.substring(lastComma+1,b+1));c+=this.enumerateString('"invoke"')+",method:"+this.enumerateString('"'+g+'"');c+=",args:[PRISMEXPRESSIONSTART("+
(f.length>0?f.join("),PRISMEXPRESSIONSTART("):"")+")]";break;case 4:b=contents.replace(/^([\w$\/]+)\s*(\{[\s\S]*?\})$/,"$1::$2").split("::"),o=b[0],src="PRISMEVALBLOCKSTART"+b[1],c+=this.enumerateString('"eval"')+",src:"+src}if(h.hasHandler===!0){c+=",callback:MESSAGEHANDLERSTART";b="";b=h.type===2?p.join(","):"result";outerDepth=0;for(f=h.endIndex+1;f<this.text.length;f++)if(this.text.charAt(f).match(/[\{\(\[]/)!==null&&outerDepth++,this.text.charAt(f).match(/[\}\)\]]/)!==null&&outerDepth--,outerDepth===
0&&this.text.charAt(f)==="}"){endIndex=f;break}d=this.text.substring(h.endIndex+1,endIndex+1);c+="("+b+")";b="prism.send("+this.enumerateString('"'+o+'"')+",new Object("+c+d+"))";this.text=this.text.substring(0,h.startIndex)+b+this.text.substring(endIndex+1,this.text.length)}else b="prism.send("+this.enumerateString('"'+o+'"')+",new Object("+c+"))",this.text=this.text.substring(0,h.startIndex)+b+this.text.substring(h.endIndex+1,this.text.length)}else l=!0;l===!0&&this.convertMessagingSyntax()}};h.reconstituteFunctions=
function(){var a=[],c=[],e,b,f,d,h,k,g,n;for(e=g=0;e<this.text.length;e++)this.text.charAt(e)==="{"&&a.push(e);for(e=a.length-1;e>=0;e--){d="";h=!1;for(b=a[e]-1;b>=0;b--)if(this.text.charAt(b).match(/[\n]/)!==null){d=this.text.substring(b+1,a[e]);break}else b===0&&(d=this.text.substring(b,a[e]));d=d.replace(/^\s*/,"");k=d.charAt(d.length-1);if(d==="")c.push({raw:d,flags:[0,-1,1,"anonymous inline, no args"],start:a[e],end:a[e]-1});else if(d.match(/[^\w\$](else|finally|try|do|PRISMEVALBLOCKSTART)$/)!==
null||d.match(/^(else|finally|try|do|PRISMEVALBLOCKSTART)$/)!==null)continue;else if(k===")"){k=0;g="";b=!1;for(f=d.length-1;f>=0;f--)if(d.charAt(f)===")"&&k++,d.charAt(f)==="("&&k--,k===0){g=d.substr(f,d.length);break}if(g==="")continue;k=d.substring(0,f).replace(/[\s\S]*?\s*(\.?)\s*((?:[a-zA-Z_\$][\w\$]*)|\])?$/,"$1$2");k.charAt(0)==="."&&(h=!0,k=k.substring(1,k.length));k.charAt(k.length-1)==="]"&&(h=!0,k="]");d.length===(k+g).length&&(b=!0);d=k+g;if(d.match(/^(if|for|while|catch|switch|with)[^\w\$]/)!==
null||d.match(/^\d/)!==null)continue;g==="()"?k===""?b===!1?c.push({raw:d,flags:[0,0,0,"anonymous, empty args"],start:a[e]-d.length,end:a[e]-1}):c.push({raw:d,flags:[0,0,1,"anonymous, empty args (inline)"],start:a[e]-d.length,end:a[e]-1}):c.push({raw:d,flags:[1,0,0,"id, empty args"],start:a[e]-d.length,end:a[e]-1,dotted:h}):k===""?g.indexOf("=")!==-1?b===!1?c.push({raw:d,flags:[0,2,0,"anonymous, args with default"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1)}):c.push({raw:d,flags:[0,
2,1,"anonymous, args with default (inline)"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1)}):b===!1?c.push({raw:d,flags:[0,1,0,"anonymous, args"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1)}):c.push({raw:d,flags:[0,1,1,"anonymous, args (inline)"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1)}):g.indexOf("=")!==-1?c.push({raw:d,flags:[1,2,0,"id, args with default"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1),dotted:h}):c.push({raw:d,
flags:[1,1,0,"id, args"],start:a[e]-d.length,end:a[e]-1,args:g.substring(1,g.length-1),dotted:h})}else k==="?"||k===":"||k==="="||k===","||d==="return "?(d="",c.push({raw:d,flags:[0,-1,0,"anonymous assignment or ternary, no args"],start:a[e],end:a[e]-1})):k===";"?(d="",c.push({raw:d,flags:[0,-1,1,"anonymous assignment, no args (inline)"],start:a[e],end:a[e]-1})):d.match(/\s*\.?\s*[a-zA-Z_\$][\w\$]*$/)!==null?(d=d.replace(/[\s\S]*?(\.?)\s*([a-zA-Z_\$][\w\$]*)$/,"$1$2"),d.charAt(0)==="."&&(h=!0,d=d.substring(1,
d.length)),c.push({raw:d,flags:[1,-1,0,"id, no args"],start:a[e]-d.length,end:a[e]-1,dotted:h})):k==="]"?(d="",h=!0,c.push({raw:d,flags:[1,-1,0,"array access, no args"],start:a[e],end:a[e]-1,dotted:h})):d.match(/^.*[\?\:\=]\s*[a-zA-Z_\$][\w\$]*$/)!==null?(d=d.replace(/^.*[\?\:\=]\s*([a-zA-Z_\$][\w\$]*)$/,"$1"),c.push({raw:d,flags:[1,-1,0,"id assignment or ternary, no args"],start:a[e]-d.length,end:a[e]-1})):k==="("?c.push({raw:"",flags:[0,-1,0,"anonymous wrapped in parens, no args"],start:a[e],end:a[e]-
1}):c.push({raw:d,flags:[-1,"unclassified"],start:b,end:a[e]-1});c[c.length-1].argBlock=""}for(e=0;e<c.length;e++)if(c[e].raw.substr(0,19)==="MESSAGEHANDLERSTART"){d=c[e].args||[];k=h=0;g=[];for(b=0;b<d.length;b++)d.charAt(b).match(/[\(\{\[]/)!==null?k++:d.charAt(b).match(/[\)\}\]]/)!==null&&k--,d.charAt(b)===","&&k===0?(g.push(d.substring(h,b)),h=b+1):b===d.length-1&&g.push(d.substring(h,b+1));a="";for(b=g.length-1;b>=0;b--)k=g[b].split("="),k.length>1&&(a+="if(typeof "+k[0]+'!=="undefined"){'+k[0]+
"="+k[1]+"}");c[e].argBlock=a;c[e].raw=c[e].raw.substring(19,c[e].raw.length);d="";for(b=0;b<g.length;b++)d+=g[b].match(/\=/)!==null?g[b].split("=")[0]+",":g[b]+",";c[e].args=d.substring(0,d.lastIndexOf(","))}else{if(this.text.charAt(c[e].end+1)!=="}")c[e].hasBody=!0;if(c[e].flags[1]>0)if(c[e].hasBody){a='if(arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null){';if(c[e].flags[1]===2){d=c[e].args;k=h=0;g=[];for(b=0;b<d.length;b++)d.charAt(b).match(/[\(\{\[]/)!==null?k++:d.charAt(b).match(/[\)\}\]]/)!==
null&&k--,d.charAt(b)===","&&k===0?(g.push(d.substring(h,b)),h=b+1):b===d.length-1&&g.push(d.substring(h,b+1));d="";for(b=0;b<g.length;b++)g[b].match(/\=/)!==null?(k=g[b].split("="),d+=k[0]+","):d+=g[b]+",";c[e].args=d.substring(0,d.lastIndexOf(","));for(b=g.length-1;b>=0;b--)g[b].match(/\=/)!==null?(k=g[b].split("="),a+=b>0?k[0]+'="'+k[0]+'"in arguments[0]?arguments[0].'+k[0]+":"+k[1]+";":k[0]+'="'+k[0]+'"in arguments[0]?arguments[0].'+k[0]+":"+k[1]):a+=b>0?'if("'+g[b]+'"in arguments[0]){'+g[b]+
"=arguments[0]."+g[b]+"}":g[b]+'="'+g[b]+'"in arguments[0]?arguments[0].'+g[b]+":undefined";a+="}else{";n="";for(b=g.length-1;b>=0;b--)g[b].match(/\=/)!==null&&(k=g[b].split("="),a+="if(typeof "+k[0]+'==="undefined"){'+k[0]+"="+k[1]+"}",n+="if(typeof "+k[0]+'==="undefined"){'+k[0]+"="+k[1]+"}")}else{g=c[e].args.split(",");for(b=g.length-1;b>=0;b--)a+=b>0?'if("'+g[b]+'"in arguments[0]){'+g[b]+"=arguments[0]."+g[b]+"}":g[b]+'="'+g[b]+'"in arguments[0]?arguments[0].'+g[b]+":undefined"}a+="}";c[e].argBlock=
a;c[e].altargBlock=n}else if(c[e].flags[1]===2){g=c[e].args.split(",");d="";for(b=0;b<g.length;b++)d+=g[b].match(/\=/)!==null?g[b].split("=")[0]+",":g[b]+",";c[e].args=d.substring(0,d.lastIndexOf(","))}if(c[e].flags[1]===0)c[e].args=""}for(e=g=0;e<c.length;e++)if(d=c[e],b=!1,d.flags[2]===1&&d.flags[0]===0?(prefixStr="INLINEFUNCTIONSTARTfunction ",g++,b=!0):prefixStr="function ",d.flags[0]!==-1)d.flags[0]===0?prefixStr+=d.flags[1]!==-1?"("+d.args+")":"()":d.flags[0]===1&&(d.flags[1]!==-1?d.dotted?
prefixStr=d.raw.substring(0,d.raw.indexOf("("))+"=function ("+d.args+")":prefixStr+=d.raw.substring(0,d.raw.indexOf("("))+"("+d.args+")":d.dotted?prefixStr=d.raw+"=function ()":prefixStr+=d.raw+"()"),prefixStr+="{"+(b&&d.altargBlock?d.altargBlock:d.argBlock),this.text=this.text.substring(0,d.start)+prefixStr+this.text.substring(d.end+2,this.text.length);for(e=0;e<g;e++){tagstart=this.text.indexOf("INLINEFUNCTIONSTART");tagend=tagstart+19;this.text=this.text.substr(0,tagstart)+"("+this.text.substring(tagend,
this.text.length);k=0;c="(";n=")";for(b=tagstart+1;b<this.text.length;b++)if(this.text.charAt(b)===c&&k++,this.text.charAt(b)===n&&k--,k===0&&this.text.charAt(b)===")")c="{",n="}";else if(k===0&&this.text.charAt(b)==="}"){this.text=this.text.substr(0,b+1)+").call(this)"+this.text.substring(b+1,this.text.length);break}}};h.reconstituteObjectLiterals=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="compiler"in arguments[0]?arguments[0].compiler:this:typeof a===
"undefined"&&(a=this);for(var c="";this.text!==c;)c=this.text,this.text=this.text.replace(/OBJECTLITERALSTART\([\s\S]*\)/,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.restoreObjectLiteral.call(a,c)})};h.convertNamedArguments=function(){this.text=this.text.replace(/new[ \t]*Object/,"new Object");for(var a=0,c=!1,e=this.text.lastIndexOf(")")+1,b=[],a=/new Object\(/g,f,d;a.exec(this.text)!==null;)b.push(a.lastIndex-
1);for(d=offset=0;d<b.length;d++){a=0;c=!1;for(f=start=b.pop();f<=e;f++)if(this.text.charAt(f).match(/[\(\{]/)!==null?a++:this.text.charAt(f).match(/[\)\}]/)!==null&&a--,a===1&&this.text.charAt(f)===":"&&this.text.substring(start,f).match(/\?/)===null&&(c=!0),a===0){if(c===!0&&this.text.charAt(f)===")")this.text=this.text.substring(0,start-10)+"{"+this.text.substring(start+1,f)+"}"+this.text.substring(f+1,this.text.length);c=!1;f=start=b.pop();f--}e=f}e=this.text.lastIndexOf(")")+1;b=[];for(f=0;f<
this.text.length;f++)this.text.substr(f,2).match(/^\([^\{\)\[]/)!==null&&b.push(f);for(d=offset=0;d<b.length;d++){a=0;c=!1;for(f=start=b.pop();f<=e;f++)if(this.text.charAt(f).match(/[\(\{]/)!==null?a++:this.text.charAt(f).match(/[\)\}]/)!==null&&a--,a===1&&this.text.charAt(f)===":"&&this.text.substring(start,f).match(/\?/)===null&&(c=!0),a===0){if(c===!0&&this.text.charAt(f)===")")this.text=this.text.substring(0,start)+"({_:null,"+this.text.substring(start+1,f)+"})"+this.text.substring(f+1,this.text.length);
c=!1;f=start=b.pop();f--}e=f}};h.rewriteWith=function(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="compiler"in arguments[0]?arguments[0].compiler:this:typeof a==="undefined"&&(a=this);this.text=this.text.replace(/^with[^\w\$][\s\S]*}/,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.withHandler.call(a,c)});for(var c;this.text.match(/[^\w\$]with[^\w\$][\s\S]*}/)!==
null&&this.text!==c;)c=this.text,this.text=this.text.replace(/[^\w\$]with[^\w\$][\s\S]*}/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.withHandler.call(a,c)})};h.separateAdjacentTerminators=function(){this.text=this.text.replace(/([\)}\w\$])(\s*?\n((?:@PLACEHOLDER[A-Z]+COMMENTS+\d+END\s*)*)\s*?\()/g,"$1;$2")};h.restoreImmutables=function(a){arguments.length===1&&typeof arguments[0]==="object"&&
arguments[0]._===null?a="compiler"in arguments[0]?arguments[0].compiler:this:typeof a==="undefined"&&(a=this);this.text=this.text.replace(/@PLACEHOLDERBLOCKCOMMENTS\d+END/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.getPlaceholder.call(a,c)});this.text=this.text.replace(/@PLACEHOLDERLINECOMMENTS\d+END/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c=
"text"in arguments[0]?arguments[0].text:void 0);return a.getPlaceholder.call(a,c)});this.text=this.text.replace(/@PLACEHOLDERBLOCKCOMMENTS\d+END/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.getPlaceholder.call(a,c)});this.text=this.text.replace(/@PLACEHOLDERSTRINGS\d+END/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:
void 0);return a.getPlaceholder.call(a,c)});this.text=this.text.replace(/@PLACEHOLDERREGEX\d+END/g,function(c){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null&&(c="text"in arguments[0]?arguments[0].text:void 0);return a.getPlaceholder.call(a,c)});this.text=this.text.replace(/@PLACEHOLDER{1}ISNTEND/g,"isn't")};h.finalise=function(){function a(a){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?a="text"in arguments[0]?arguments[0].text:"":typeof a===
"undefined"&&(a="");if(a.match(/\n/)!==null){var c=a.split("\n"),d=Infinity,e,h=!0;if(c[0].match(/^ +/)===null)for(var g=1;g<c.length;g++){var n=c[g].replace(/^( +|\t+)[^\1][\s\S]*$/,"$1");if(n!==c[g]){if(n.charAt(0)!==e&&g>1){h=!1;break}d=Math.min(n.length,d);e=n.charAt(0)}else d=0}if(d>0&&d<Infinity&&h===!0){for(g=1;g<c.length;g++)c[g]=c[g].substring(d,c[g].length);a=c.join("\n")}}a=a.replace(/([^\\])""/g,'$1\\"\\"');a=a.replace(/([^\\])"/g,'$1\\"');a=a.replace(/^"/g,'\\"');a=a.replace(/([^\\])(\n)/g,
"$1\\n\\$2");return a=a.replace(/^(\n)/gm,"\\n\\$1")}this.text=this.text.replace(/([\)}])(\s*?\n\s*?\()/g,"$1;$2");for(var c=/PRISMEXPRESSIONSTART\(/g,e=[];c.exec(this.text)!==null;)e.push(c.lastIndex-1);e.reverse();for(i=0;i<e.length;i++){depth=0;for(j=e[i];j<this.text.length;j++)if(this.text.charAt(j)==="("&&depth++,this.text.charAt(j)===")"&&depth--,depth===0){if(this.text.charAt(j)===")")this.text=this.text.substring(0,e[i]-20)+this.text.substring(e[i]+1,j)+this.text.substring(j+1,this.text.length);
break}}c=/PRISMEVALBLOCKSTART\{/g;for(e=[];c.exec(this.text)!==null;)e.push(c.lastIndex-1);e.reverse();for(i=0;i<e.length;i++){depth=0;for(j=e[i];j<this.text.length;j++)if(this.text.charAt(j)==="{"&&depth++,this.text.charAt(j)==="}"&&depth--,depth===0){if(this.text.charAt(j)==="}")this.text=this.text.substring(0,e[i]-19)+'"'+a(this.text.substring(e[i]+1,j))+'"'+this.text.substring(j+1,this.text.length);break}}}}).call(this,JS11.Compiler.prototype);
if(typeof window==="undefined"&&typeof global==="undefined"){var compiler=new JS11.Compiler;this.onmessage=function(h){arguments.length===1&&typeof arguments[0]==="object"&&arguments[0]._===null?h="event"in arguments[0]?arguments[0].event:{data:""}:typeof h==="undefined"&&(h={data:""});postMessage({type:"JS11",src:compiler.toJS(h.data)})}};